{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ToolDecoded - Product Database{% endblock %}</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com/3.4.0/plugins/typography.js"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'brand-blue': '#1e40af',
                            'brand-gray': '#6b7280',
                            'brand-green': '#059669',
                            'brand-purple': '#7c3aed',
                            'brand-orange': '#ea580c',
                        },
                        backdropBlur: {
                            xs: '2px',
                        }
                    }
                }
            }
        </script>
    <style>
        /* Comprehensive fallback CSS for markdown rendering */
        .prose {
            color: #374151;
            line-height: 1.75;
            max-width: 65ch;
        }
        
        .prose h1 {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.111;
            margin-top: 0;
            margin-bottom: 2rem;
            color: #111827;
        }
        
        .prose h2 {
            font-size: 1.875rem;
            font-weight: 700;
            line-height: 1.333;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #111827;
        }
        
        .prose h3 {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.6;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #111827;
        }
        
        .prose h4 {
            font-size: 1.25rem;
            font-weight: 600;
            line-height: 1.6;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }
        
        .prose h5 {
            font-size: 1.125rem;
            font-weight: 600;
            line-height: 1.6;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }
        
        .prose h6 {
            font-size: 1rem;
            font-weight: 600;
            line-height: 1.6;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }
        
        .prose p {
            margin-top: 1.25rem;
            margin-bottom: 1.25rem;
        }
        
        .prose ul {
            list-style-type: disc;
            margin-top: 1.25rem;
            margin-bottom: 1.25rem;
            padding-left: 1.625rem;
        }
        
        .prose ol {
            list-style-type: decimal;
            margin-top: 1.25rem;
            margin-bottom: 1.25rem;
            padding-left: 1.625rem;
        }
        
        .prose li {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .prose ul ul, .prose ol ol, .prose ul ol, .prose ol ul {
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .prose blockquote {
            font-weight: 500;
            font-style: italic;
            color: #111827;
            border-left-width: 0.25rem;
            border-left-color: #e5e7eb;
            quotes: "\201C""\201D""\2018""\2019";
            margin-top: 1.6rem;
            margin-bottom: 1.6rem;
            padding-left: 1rem;
        }
        
        .prose blockquote p:first-of-type::before {
            content: open-quote;
        }
        
        .prose blockquote p:last-of-type::after {
            content: close-quote;
        }
        
        .prose code {
            color: #111827;
            font-weight: 600;
            font-size: 0.875em;
            background-color: #f3f4f6;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }
        
        .prose pre {
            color: #e5e7eb;
            background-color: #1f2937;
            overflow-x: auto;
            font-weight: 400;
            font-size: 0.875em;
            line-height: 1.7142857;
            margin-top: 1.7142857em;
            margin-bottom: 1.7142857em;
            border-radius: 0.375rem;
            padding: 0.8571429em 1.1428571em;
        }
        
        .prose pre code {
            background-color: transparent;
            border-width: 0;
            border-radius: 0;
            padding: 0;
            font-weight: inherit;
            color: inherit;
            font-size: inherit;
            font-family: inherit;
            line-height: inherit;
        }
        
        .prose table {
            width: 100%;
            table-layout: auto;
            text-align: left;
            margin-top: 2em;
            margin-bottom: 2em;
            font-size: 0.875em;
            line-height: 1.7142857;
            border-collapse: collapse;
        }
        
        .prose thead {
            border-bottom-width: 1px;
            border-bottom-color: #d1d5db;
        }
        
        .prose thead th {
            color: #111827;
            font-weight: 600;
            vertical-align: bottom;
            padding-right: 0.5714286em;
            padding-bottom: 0.5714286em;
            padding-left: 0.5714286em;
        }
        
        .prose tbody tr {
            border-bottom-width: 1px;
            border-bottom-color: #e5e7eb;
        }
        
        .prose tbody tr:last-child {
            border-bottom-width: 0;
        }
        
        .prose tbody td {
            vertical-align: baseline;
            padding-top: 0.5714286em;
            padding-right: 0.5714286em;
            padding-bottom: 0.5714286em;
            padding-left: 0.5714286em;
        }
        
        .prose a {
            color: #2563eb;
            text-decoration: underline;
            font-weight: 500;
        }
        
        .prose a:hover {
            color: #1d4ed8;
        }
        
        .prose strong {
            color: #111827;
            font-weight: 600;
        }
        
        .prose em {
            color: #111827;
            font-style: italic;
        }
        
        .prose u {
            text-decoration: underline;
        }
        
        .prose img {
            margin-top: 2em;
            margin-bottom: 2em;
            max-width: 100%;
            height: auto;
        }
        
        .prose br {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Logo responsive styles */
        .logo {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        /* Ensure logo maintains aspect ratio on all devices */
        @media (max-width: 768px) {
            .logo {
                max-height: 2rem;
            }
        }
        
        @media (min-width: 769px) {
            .logo {
                max-height: 3rem;
            }
        }
        
        
        /* Custom Dropdown Styles - Clean & Modern */
        .custom-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
            transition: all 0.15s ease;
        }
        
        /* Mobile-first responsive sizing */
        .custom-select {
            min-height: 44px; /* iOS minimum touch target */
            font-size: 16px; /* Prevents zoom on iOS */
            padding: 0.75rem 2.5rem 0.75rem 0.75rem;
            border: none;
            border-radius: 0.5rem;
            background-color: transparent;
            color: #374151;
            line-height: 1.5;
        }
        
        /* Desktop styling - clean and modern */
        @media (min-width: 768px) {
            .custom-select {
                min-height: 38px;
                font-size: 14px;
                padding: 0.5rem 2.25rem 0.5rem 0.75rem;
                border: none;
                border-radius: 0.5rem;
                background-color: transparent;
            }
        }
        
        /* Focus states */
        .custom-select:focus {
            outline: none;
            background-color: rgba(59, 130, 246, 0.05);
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%233b82f6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        }
        
        /* Hover states */
        .custom-select:hover:not(:focus) {
            background-color: rgba(0, 0, 0, 0.02);
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23374151' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        }
        
        /* Disabled states */
        .custom-select:disabled {
            background-color: transparent;
            color: #9ca3af;
            cursor: not-allowed;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23d1d5db' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .custom-select {
                background-color: transparent;
                color: #f9fafb;
            }
            
            .custom-select:focus {
                background-color: rgba(96, 165, 250, 0.1);
            }
            
            .custom-select:hover:not(:focus) {
                background-color: rgba(255, 255, 255, 0.05);
            }
        }
        
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo/Brand - HTML/CSS Version v3 -->
                <div class="flex items-center flex-shrink-0 min-w-0">
                    <a href="{% url 'home' %}" class="flex items-center group">
                        <!-- Desktop Logo -->
                        <div class="hidden md:block">
                            <img src="{% static 'frontend/images/logo_lightbg.png' %}" alt="ToolDecoded Logo" class="h-12 w-auto min-w-[200px]">
                        </div>
                        <!-- Mobile Logo -->
                        <div class="md:hidden">
                            <img src="{% static 'frontend/images/logo_lightbg.png' %}" alt="ToolDecoded Logo" class="h-8 w-auto min-w-[150px]">
                        </div>
                    </a>
                </div>
                
                <!-- Enhanced Global Search Bar - Desktop Full Width -->
                <div class="hidden xl:flex flex-1 max-w-lg mx-8">
                    <div class="relative w-full">
                        <div class="relative">
                            <input type="text" 
                                   id="global-search" 
                                   class="w-full px-4 py-2.5 pl-10 pr-12 text-sm border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white"
                                   placeholder="Search products, components, brands...">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <kbd class="px-2 py-1 text-xs font-semibold text-gray-500 bg-gray-100 border border-gray-200 rounded">⌘K</kbd>
                            </div>
                        </div>
                        <div id="search-suggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-xl shadow-xl mt-2 hidden z-50 max-h-96 overflow-y-auto">
                            <!-- Search suggestions will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Search Icon Button - Shows when space is limited -->
                <div class="hidden md:flex xl:hidden">
                    <button id="search-icon-button" onclick="toggleSearchModal()" class="p-2 text-gray-600 hover:text-blue-600 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>

                <!-- Main Navigation -->
                <nav class="hidden md:flex space-x-4 xl:space-x-8">
                    <!-- Home (standalone) -->
                    <a href="{% url 'home' %}" class="text-sm font-medium {% if request.resolver_match.url_name == 'home' %}text-blue-600 border-b-2 border-blue-600{% else %}text-gray-600 hover:text-gray-900{% endif %} transition-colors pb-1">
                        Home
                    </a>
                    
                    <!-- Featured (standalone) -->
                    <a href="{% url 'browse_flagship' %}" class="text-sm font-medium {% if request.resolver_match.url_name == 'browse_flagship' %}text-blue-600 border-b-2 border-blue-600{% else %}text-gray-600 hover:text-gray-900{% endif %} transition-colors pb-1">
                        Featured
                    </a>
                    
                    <!-- Explore Dropdown -->
                    <div class="relative group">
                        <button class="text-sm font-medium {% if request.resolver_match.url_name == 'components_index' or request.resolver_match.url_name == 'component_detail' or request.resolver_match.url_name == 'index' or request.resolver_match.url_name == 'product_detail' %}text-blue-600 border-b-2 border-blue-600{% else %}text-gray-600 hover:text-gray-900{% endif %} transition-colors pb-1 flex items-center">
                            Explore
                            <svg class="ml-1 h-4 w-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute top-full left-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <div class="py-2">
                                <a href="{% url 'components_index' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                                    Tools & Components
                                </a>
                                <a href="{% url 'index' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                                    Products
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Learn (standalone) -->
                    <a href="{% url 'learning_index' %}" class="text-sm font-medium {% if request.resolver_match.url_name == 'learning_index' or request.resolver_match.url_name == 'learning_detail' %}text-blue-600 border-b-2 border-blue-600{% else %}text-gray-600 hover:text-gray-900{% endif %} transition-colors pb-1">
                        Learn
                    </a>
                    
                    <!-- About Dropdown -->
                    <div class="relative group">
                        <button class="text-sm font-medium {% if request.resolver_match.url_name == 'about' or request.resolver_match.url_name == 'contact' %}text-blue-600 border-b-2 border-blue-600{% else %}text-gray-600 hover:text-gray-900{% endif %} transition-colors pb-1 flex items-center">
                            About
                            <svg class="ml-1 h-4 w-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute top-full left-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <div class="py-2">
                                <a href="{% url 'about' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                                    About
                                </a>
                                <a href="{% url 'contact' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                                    Contact
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>
                
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button type="button" class="text-gray-600 hover:text-gray-900 focus:outline-none focus:text-gray-900" onclick="toggleMobileMenu()">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div id="mobile-menu" class="md:hidden hidden border-t border-gray-200 py-4">
                <nav class="flex flex-col space-y-1">
                    <!-- Home (standalone) -->
                    <a href="{% url 'home' %}" class="text-sm font-medium {% if request.resolver_match.url_name == 'home' %}text-blue-600 bg-blue-50{% else %}text-gray-600 hover:text-gray-900 hover:bg-gray-50{% endif %} transition-colors py-3 px-4 rounded-lg">
                        Home
                    </a>
                    
                    <!-- Featured (standalone) -->
                    <a href="{% url 'browse_flagship' %}" class="text-sm font-medium {% if request.resolver_match.url_name == 'browse_flagship' %}text-blue-600 bg-blue-50{% else %}text-gray-600 hover:text-gray-900 hover:bg-gray-50{% endif %} transition-colors py-3 px-4 rounded-lg">
                        Featured
                    </a>
                    
                    <!-- Explore Accordion -->
                    <div class="space-y-1">
                        <button onclick="toggleMobileDropdown('explore')" class="w-full text-left text-sm font-medium {% if request.resolver_match.url_name == 'components_index' or request.resolver_match.url_name == 'component_detail' or request.resolver_match.url_name == 'index' or request.resolver_match.url_name == 'product_detail' %}text-blue-600 bg-blue-50{% else %}text-gray-600 hover:text-gray-900 hover:bg-gray-50{% endif %} transition-colors py-3 px-4 rounded-lg flex items-center justify-between">
                            <span>Explore</span>
                            <svg id="explore-arrow" class="h-4 w-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="explore-dropdown" class="hidden pl-4 space-y-1">
                            <a href="{% url 'components_index' %}" class="block text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors py-2 px-4 rounded-lg">
                                Tools & Components
                            </a>
                            <a href="{% url 'index' %}" class="block text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors py-2 px-4 rounded-lg">
                                Products
                            </a>
                        </div>
                    </div>
                    
                    <!-- Learn (standalone) -->
                    <a href="{% url 'learning_index' %}" class="text-sm font-medium {% if request.resolver_match.url_name == 'learning_index' or request.resolver_match.url_name == 'learning_detail' %}text-blue-600 bg-blue-50{% else %}text-gray-600 hover:text-gray-900 hover:bg-gray-50{% endif %} transition-colors py-3 px-4 rounded-lg">
                        Learn
                    </a>
                    
                    <!-- About Accordion -->
                    <div class="space-y-1">
                        <button onclick="toggleMobileDropdown('about')" class="w-full text-left text-sm font-medium {% if request.resolver_match.url_name == 'about' or request.resolver_match.url_name == 'contact' %}text-blue-600 bg-blue-50{% else %}text-gray-600 hover:text-gray-900 hover:bg-gray-50{% endif %} transition-colors py-3 px-4 rounded-lg flex items-center justify-between">
                            <span>About</span>
                            <svg id="about-arrow" class="h-4 w-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="about-dropdown" class="hidden pl-4 space-y-1">
                            <a href="{% url 'about' %}" class="block text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors py-2 px-4 rounded-lg">
                                About
                            </a>
                            <a href="{% url 'contact' %}" class="block text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors py-2 px-4 rounded-lg">
                                Contact
                            </a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Brand Section -->
                <div class="col-span-1 md:col-span-2">
                    <div class="mb-4">
                        <img src="{% static 'frontend/images/logo_darkbg.png' %}" alt="ToolDecoded Logo" class="h-10 w-auto">
                    </div>
                    <p class="text-gray-300 text-sm leading-relaxed mb-4">
                        A comprehensive database and analysis platform for power tools, components, and accessories. 
                        Find detailed specifications, compatibility information, and component relationships across major tool brands.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
                    <div class="grid grid-rows-4 grid-flow-col gap-x-6 gap-y-2">
                        <div><a href="{% url 'home' %}" class="text-gray-300 hover:text-white transition-colors text-sm">Home</a></div>
                        <div><a href="{% url 'browse_flagship' %}" class="text-gray-300 hover:text-white transition-colors text-sm">Featured</a></div>
                        <div><a href="{% url 'index' %}" class="text-gray-300 hover:text-white transition-colors text-sm">All Products</a></div>
                        <div><a href="{% url 'components_index' %}" class="text-gray-300 hover:text-white transition-colors text-sm">Tools & Components</a></div>
                        <div><a href="{% url 'learning_index' %}" class="text-gray-300 hover:text-white transition-colors text-sm">Learn</a></div>
                        <div><a href="{% url 'about' %}" class="text-gray-300 hover:text-white transition-colors text-sm">About</a></div>
                        <div><a href="{% url 'contact' %}" class="text-gray-300 hover:text-white transition-colors text-sm">Contact</a></div>
                    </div>
                </div>
                
                <!-- Contact Info -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Contact</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                        <p>For questions about the database or to suggest additions:</p>
                        <a href="{% url 'contact' %}" class="text-blue-400 hover:text-blue-300 transition-colors">Use our contact form</a>
                        <p class="text-xs text-gray-400 mt-4">
                            Database updated regularly with new products and specifications.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="border-t border-gray-800 mt-8 pt-6 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm">
                    © 2025 ToolDecoded. All rights reserved.
                </p>
                <p class="text-gray-400 text-xs mt-2 md:mt-0">
                    Product information provided for research and comparison purposes.
                </p>
            </div>
        </div>
    </footer>

    <!-- Mobile Menu JavaScript -->
    <script>
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        }

        // Mobile Dropdown Toggle
        function toggleMobileDropdown(dropdownName) {
            const dropdown = document.getElementById(dropdownName + '-dropdown');
            const arrow = document.getElementById(dropdownName + '-arrow');
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                dropdown.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Mobile touch controls
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });

        function handleSwipe() {
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const minSwipeDistance = 50;

            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0) {
                    // Swipe right - open mobile menu
                    const mobileMenu = document.getElementById('mobile-menu');
                    if (mobileMenu && mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.remove('hidden');
                    }
                } else {
                    // Swipe left - close mobile menu
                    const mobileMenu = document.getElementById('mobile-menu');
                    if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
            }
        }

        // Mobile filter drawer
        function toggleMobileFilters() {
            const filterDrawer = document.getElementById('mobile-filter-drawer');
            if (filterDrawer) {
                filterDrawer.classList.toggle('hidden');
            }
        }

        // Close mobile filters when clicking outside
        document.addEventListener('click', function(e) {
            const filterDrawer = document.getElementById('mobile-filter-drawer');
            const filterButton = document.getElementById('mobile-filter-button');
            
            if (filterDrawer && filterButton && 
                !filterDrawer.contains(e.target) && 
                !filterButton.contains(e.target)) {
                filterDrawer.classList.add('hidden');
            }
        });

        // Comparison functionality - HIDDEN FOR DEBUGGING
        /*
        let comparisonList = JSON.parse(localStorage.getItem('comparisonList') || '[]');

        function addToComparison(itemId, itemType) {
            if (comparisonList.length >= 4) {
                showToast('Maximum 4 items can be compared at once', 'warning');
                return;
            }
            
            const item = { id: itemId, type: itemType };
            if (!comparisonList.find(i => i.id === itemId && i.type === itemType)) {
                comparisonList.push(item);
                localStorage.setItem('comparisonList', JSON.stringify(comparisonList));
                updateComparisonButton();
                showToast('Item added to comparison', 'success');
            }
        }

        function removeFromComparison(itemId, itemType) {
            comparisonList = comparisonList.filter(i => !(i.id === itemId && i.type === itemType));
            localStorage.setItem('comparisonList', JSON.stringify(comparisonList));
            updateComparisonButton();
        }

        function updateComparisonButton() {
            const button = document.getElementById('compare-button');
            if (button) {
                button.textContent = `Compare (${comparisonList.length})`;
                button.disabled = comparisonList.length < 2;
            }
        }

        function openComparisonModal() {
            if (comparisonList.length < 2) {
                showToast('Please select at least 2 items to compare', 'warning');
                return;
            }
            
            const modal = document.getElementById('comparison-modal');
            const content = document.getElementById('comparison-content');
            
            // Clear previous content
            content.innerHTML = '';
            
            // Create comparison table
            const table = document.createElement('div');
            table.className = 'overflow-x-auto';
            table.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feature</th>
                            ${comparisonList.map(item => `
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    ${item.type === 'product' ? 'Product' : 'Component'} ${item.id}
                                </th>
                            `).join('')}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Name</td>
                            ${comparisonList.map(item => `
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <div class="flex items-center justify-between">
                                        <span>Item ${item.id}</span>
                                        <button onclick="removeFromComparison('${item.id}', '${item.type}')" class="text-red-600 hover:text-red-800">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            `).join('')}
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Type</td>
                            ${comparisonList.map(item => `
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.type}</td>
                            `).join('')}
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Status</td>
                            ${comparisonList.map(item => `
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Available</td>
                            `).join('')}
                        </tr>
                    </tbody>
                </table>
            `;
            
            content.appendChild(table);
            modal.classList.remove('hidden');
        }

        function closeComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            modal.classList.add('hidden');
        }
        */

        // Search Modal Functions
        function toggleSearchModal() {
            const modal = document.getElementById('search-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                // Focus the search input when modal opens
                setTimeout(() => {
                    const searchInput = document.getElementById('modal-search');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }, 100);
            }
        }

        function closeSearchModal() {
            const modal = document.getElementById('search-modal');
            modal.classList.add('hidden');
        }

        // Initialize comparison button on page load - HIDDEN FOR DEBUGGING
        /*
        document.addEventListener('DOMContentLoaded', function() {
            updateComparisonButton();
        });
        */
    </script>

    
    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50" onclick="closeSearchModal()"></div>
        <div class="relative max-w-4xl mx-auto p-4 h-full flex items-start pt-20">
            <div class="bg-white rounded-xl shadow-2xl w-full max-h-[80vh] overflow-hidden">
                <div class="flex items-center justify-between p-6 border-b">
                    <h2 class="text-xl font-bold text-gray-900">Search</h2>
                    <button onclick="closeSearchModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-6">
                    <div class="relative">
                        <input type="text" 
                               id="modal-search" 
                               class="w-full px-4 py-3 pl-12 pr-4 text-lg border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white"
                               placeholder="Search products, components, brands...">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <svg class="h-6 w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <div id="modal-search-suggestions" class="mt-4 max-h-96 overflow-y-auto">
                        <!-- Search suggestions will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Comparison Modal - HIDDEN FOR DEBUGGING -->
    <!--
    <div id="comparison-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50" onclick="closeComparisonModal()"></div>
        <div class="relative max-w-7xl mx-auto p-4 h-full flex items-center">
            <div class="bg-white rounded-xl shadow-2xl w-full max-h-[90vh] overflow-hidden">
                <div class="flex items-center justify-between p-6 border-b">
                    <h2 class="text-2xl font-bold text-gray-900">Compare Products</h2>
                    <button onclick="closeComparisonModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                    <div id="comparison-content" class="space-y-6">
                        <!-- Comparison content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    -->
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <style>
        /* Comparison table enhancements */
        .comparison-table th {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #f9fafb;
        }
        
        .comparison-table .highlight-difference {
            background-color: #fef3c7 !important;
            color: #92400e !important;
        }
        
        .comparison-table .section-header {
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .comparison-table .spec-value {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
        }
        
        .comparison-table .price-value {
            font-weight: 600;
            color: #059669;
        }
        
        /* Mobile comparison table */
        @media (max-width: 1024px) {
            .comparison-table-mobile {
                display: block;
            }
            
            .comparison-table-desktop {
                display: none;
            }
            
            .comparison-card {
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                margin-bottom: 1rem;
                overflow: hidden;
            }
            
            .comparison-card-header {
                background: #f9fafb;
                padding: 1rem;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .comparison-card-body {
                padding: 1rem;
            }
            
            .comparison-spec-row {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                border-bottom: 1px solid #f3f4f6;
            }
            
            .comparison-spec-label {
                font-weight: 500;
                color: #374151;
                flex: 1;
            }
            
            .comparison-spec-value {
                color: #6b7280;
                text-align: right;
                flex: 1;
            }
            
            .comparison-spec-value.different {
                background-color: #fef3c7;
                color: #92400e;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
            }
        }
        
        @media (min-width: 1025px) {
            .comparison-table-mobile {
                display: none;
            }
            
            .comparison-table-desktop {
                display: block;
            }
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .mobile-touch-target {
                min-height: 44px;
                min-width: 44px;
            }
            
            .mobile-swipe-indicator {
                position: relative;
            }
            
            .mobile-swipe-indicator::before {
                content: '';
                position: absolute;
                left: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 4px;
                height: 20px;
                background: linear-gradient(to bottom, #3b82f6, #1d4ed8);
                border-radius: 2px;
                opacity: 0.6;
            }
            
            .mobile-filter-drawer {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: white;
                z-index: 50;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }
            
            .mobile-filter-drawer.open {
                transform: translateX(0);
            }
            
            .mobile-card {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            .mobile-button {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        }
        
        /* Enhanced Visual Polish */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Micro-interactions and animations */
        .hover-lift {
            transition: transform 0.2s ease-in-out;
        }

        .hover-lift:hover {
            transform: translateY(-2px);
        }

        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .ripple:active::before {
            width: 300px;
            height: 300px;
        }


        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        
        
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .ripple:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>

    <!-- Smart Search JavaScript -->
    <script>
        class SmartSearch {
            constructor() {
                this.searchInput = document.getElementById('global-search');
                this.modalSearchInput = document.getElementById('modal-search');
                this.suggestionsContainer = document.getElementById('search-suggestions');
                this.modalSuggestionsContainer = document.getElementById('modal-search-suggestions');
                this.debounceTimer = null;
                this.modalDebounceTimer = null;
                this.init();
            }
            
            init() {
                // Main search input
                if (this.searchInput) {
                    this.searchInput.addEventListener('input', (e) => {
                        this.debounceSearch(e.target.value);
                    });
                    
                    this.searchInput.addEventListener('focus', () => {
                        if (this.searchInput.value.length >= 2) {
                            this.showSuggestions();
                        }
                    });
                    
                    this.searchInput.addEventListener('keydown', (e) => {
                        this.handleKeydown(e);
                    });
                }

                // Modal search input
                if (this.modalSearchInput) {
                    this.modalSearchInput.addEventListener('input', (e) => {
                        this.debounceModalSearch(e.target.value);
                    });
                    
                    this.modalSearchInput.addEventListener('keydown', (e) => {
                        this.handleModalKeydown(e);
                    });
                }
                
                document.addEventListener('click', (e) => {
                    if (this.searchInput && !this.searchInput.contains(e.target) && !this.suggestionsContainer.contains(e.target)) {
                        this.hideSuggestions();
                    }
                });
                
                // Add keyboard shortcut support (Cmd/Ctrl + K)
                document.addEventListener('keydown', (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        if (this.searchInput) {
                            this.searchInput.focus();
                        } else {
                            toggleSearchModal();
                        }
                    }
                });
            }
            
            debounceSearch(query) {
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    this.performSearch(query);
                }, 300);
            }

            debounceModalSearch(query) {
                clearTimeout(this.modalDebounceTimer);
                this.modalDebounceTimer = setTimeout(() => {
                    this.performModalSearch(query);
                }, 300);
            }
            
            async performSearch(query) {
                if (query.length < 2) {
                    this.hideSuggestions();
                    return;
                }
                
                try {
                    const response = await fetch(`/api/search-suggestions/?q=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    this.displaySuggestions(data.suggestions);
                } catch (error) {
                    console.error('Search error:', error);
                    this.hideSuggestions();
                }
            }

            async performModalSearch(query) {
                if (query.length < 2) {
                    this.hideModalSuggestions();
                    return;
                }
                
                try {
                    const response = await fetch(`/api/search-suggestions/?q=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    this.displayModalSuggestions(data.suggestions);
                } catch (error) {
                    console.error('Search error:', error);
                    this.hideModalSuggestions();
                }
            }
            
            displaySuggestions(suggestions) {
                if (suggestions.length === 0) {
                    this.hideSuggestions();
                    return;
                }
                
                // Group suggestions by type
                const grouped = {
                    'Product': [],
                    'Component': [],
                    'Brand': []
                };
                
                suggestions.forEach(item => {
                    if (grouped[item.type]) {
                        grouped[item.type].push(item);
                    }
                });
                
                let html = '';
                
                // Add recent searches if any
                const recentSearches = this.getRecentSearches();
                if (recentSearches.length > 0 && suggestions.length === 0) {
                    html += '<div class="p-3 border-b border-gray-100">';
                    html += '<div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 flex items-center">';
                    html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    html += 'Recent Searches</div>';
                    recentSearches.forEach(search => {
                        html += `<div class="px-3 py-2 hover:bg-blue-50 cursor-pointer rounded-lg flex items-center group transition-colors" onclick="smartSearch.selectSuggestion('${search}')">`;
                        html += `<svg class="w-4 h-4 text-gray-400 mr-3 group-hover:text-blue-500" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                        html += `<span class="text-sm text-gray-700 group-hover:text-blue-700">${search}</span></div>`;
                    });
                    html += '</div>';
                }
                
                // Add suggestions by type
                Object.keys(grouped).forEach(type => {
                    if (grouped[type].length > 0) {
                        html += '<div class="p-3">';
                        html += `<div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 flex items-center">`;
                        if (type === 'Product') {
                            html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>';
                        } else if (type === 'Component') {
                            html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path></svg>';
                        } else {
                            html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>';
                        }
                        html += `${type}s</div>`;
                        grouped[type].forEach(item => {
                            html += `<div class="px-3 py-2.5 hover:bg-blue-50 cursor-pointer rounded-lg flex items-center group transition-colors" onclick="smartSearch.selectSuggestion('${item.text}', '${item.url}')">`;
                            html += `<div class="flex-1">`;
                            html += `<div class="text-sm font-medium text-gray-900 group-hover:text-blue-700">${item.text}</div>`;
                            if (item.brand) {
                                html += `<div class="text-xs text-gray-500 group-hover:text-blue-600">${item.brand}</div>`;
                            }
                            if (item.sku) {
                                html += `<div class="text-xs text-gray-400 group-hover:text-blue-500">Model#: ${item.sku}</div>`;
                            }
                            html += `</div>`;
                            html += `<span class="text-xs text-gray-400 group-hover:text-blue-500 ml-2 px-2 py-1 bg-gray-100 group-hover:bg-blue-100 rounded-full">${type}</span>`;
                            html += `</div>`;
                        });
                        html += '</div>';
                    }
                });
                
                this.suggestionsContainer.innerHTML = html;
                this.showSuggestions();
            }
            
            selectSuggestion(text, url = null) {
                if (url) {
                    this.addToRecentSearches(text);
                    window.location.href = url;
                } else {
                    // Search for this text
                    this.searchInput.value = text;
                    this.addToRecentSearches(text);
                    this.performSearch(text);
                }
            }
            
            handleKeydown(e) {
                const suggestions = this.suggestionsContainer.querySelectorAll('[onclick]');
                const current = this.suggestionsContainer.querySelector('.bg-blue-50');
                let index = -1;
                
                if (current) {
                    index = Array.from(suggestions).indexOf(current);
                }
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    index = Math.min(index + 1, suggestions.length - 1);
                    this.highlightSuggestion(suggestions, index);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    index = Math.max(index - 1, -1);
                    this.highlightSuggestion(suggestions, index);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (current) {
                        current.click();
                    } else if (this.searchInput.value.trim()) {
                        this.searchInput.form.submit();
                    }
                } else if (e.key === 'Escape') {
                    this.hideSuggestions();
                }
            }
            
            highlightSuggestion(suggestions, index) {
                suggestions.forEach(s => s.classList.remove('bg-blue-50'));
                if (index >= 0 && suggestions[index]) {
                    suggestions[index].classList.add('bg-blue-50');
                }
            }
            
            showSuggestions() {
                this.suggestionsContainer.classList.remove('hidden');
            }
            
            hideSuggestions() {
                this.suggestionsContainer.classList.add('hidden');
            }

            displayModalSuggestions(suggestions) {
                if (suggestions.length === 0) {
                    this.hideModalSuggestions();
                    return;
                }
                
                // Group suggestions by type
                const grouped = {
                    'Product': [],
                    'Component': [],
                    'Brand': []
                };
                
                suggestions.forEach(item => {
                    if (grouped[item.type]) {
                        grouped[item.type].push(item);
                    }
                });
                
                let html = '';
                
                // Add suggestions by type
                Object.keys(grouped).forEach(type => {
                    if (grouped[type].length > 0) {
                        html += '<div class="p-3">';
                        html += `<div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 flex items-center">`;
                        if (type === 'Product') {
                            html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>';
                        } else if (type === 'Component') {
                            html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path></svg>';
                        } else {
                            html += '<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>';
                        }
                        html += `${type}s</div>`;
                        grouped[type].forEach(item => {
                            html += `<div class="px-3 py-2.5 hover:bg-blue-50 cursor-pointer rounded-lg flex items-center group transition-colors" onclick="smartSearch.selectModalSuggestion('${item.text}', '${item.url}')">`;
                            html += `<div class="flex-1">`;
                            html += `<div class="text-sm font-medium text-gray-900 group-hover:text-blue-700">${item.text}</div>`;
                            if (item.brand) {
                                html += `<div class="text-xs text-gray-500 group-hover:text-blue-600">${item.brand}</div>`;
                            }
                            if (item.sku) {
                                html += `<div class="text-xs text-gray-400 group-hover:text-blue-500">Model#: ${item.sku}</div>`;
                            }
                            html += `</div>`;
                            html += `<span class="text-xs text-gray-400 group-hover:text-blue-500 ml-2 px-2 py-1 bg-gray-100 group-hover:bg-blue-100 rounded-full">${type}</span>`;
                            html += `</div>`;
                        });
                        html += '</div>';
                    }
                });
                
                this.modalSuggestionsContainer.innerHTML = html;
                this.showModalSuggestions();
            }

            selectModalSuggestion(text, url = null) {
                if (url) {
                    this.addToRecentSearches(text);
                    window.location.href = url;
                } else {
                    // Search for this text
                    this.modalSearchInput.value = text;
                    this.addToRecentSearches(text);
                    this.performModalSearch(text);
                }
            }

            showModalSuggestions() {
                this.modalSuggestionsContainer.classList.remove('hidden');
            }

            hideModalSuggestions() {
                this.modalSuggestionsContainer.classList.add('hidden');
            }

            handleModalKeydown(e) {
                const suggestions = this.modalSuggestionsContainer.querySelectorAll('[onclick]');
                const current = this.modalSuggestionsContainer.querySelector('.bg-blue-50');
                let index = -1;
                
                if (current) {
                    index = Array.from(suggestions).indexOf(current);
                }
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    index = Math.min(index + 1, suggestions.length - 1);
                    this.highlightSuggestion(suggestions, index);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    index = Math.max(index - 1, -1);
                    this.highlightSuggestion(suggestions, index);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (current) {
                        current.click();
                    } else if (this.modalSearchInput.value.trim()) {
                        // Perform search
                        this.performModalSearch(this.modalSearchInput.value);
                    }
                } else if (e.key === 'Escape') {
                    closeSearchModal();
                }
            }
            
            getRecentSearches() {
                try {
                    return JSON.parse(localStorage.getItem('recentSearches') || '[]');
                } catch {
                    return [];
                }
            }
            
            addToRecentSearches(search) {
                try {
                    let recent = this.getRecentSearches();
                    recent = recent.filter(s => s !== search);
                    recent.unshift(search);
                    recent = recent.slice(0, 5); // Keep only 5 recent searches
                    localStorage.setItem('recentSearches', JSON.stringify(recent));
                } catch {
                    // Ignore localStorage errors
                }
            }
        }
        
        // Initialize smart search when DOM is loaded
        let smartSearch;
        document.addEventListener('DOMContentLoaded', function() {
            smartSearch = new SmartSearch();
        });
    </script>

    <script>
    </script>
</body>
</html>
