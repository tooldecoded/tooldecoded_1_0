{% extends 'frontend/base.html' %}
{% load product_filters %}

{% block title %}Browse Flagship Components - ToolDecoded{% endblock %}

{% block content %}
<div class="bg-white min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-[#313131] mb-4">Browse Flagship Tools & Components</h1>
            <p class="text-xl text-[#505050] max-w-3xl">
                Discover our curated selection of flagship components from major brands, 
                organized by item type for easy exploration.
            </p>
        </div>

        {% if not has_products %}
        <!-- No SKUs configured message -->
        <div class="bg-[#F5F6F8] border border-[#E1E4E8] rounded-2xl p-8 text-center">
            <div class="w-20 h-20 bg-[#0089D9] rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-semibold text-[#313131] mb-4">Configure Flagship Tools & Components</h3>
            <p class="text-[#505050] mb-6 text-lg">
                To display flagship components, mark components as featured in the admin panel
            </p>
            <div class="bg-white rounded-2xl p-6 text-left max-w-2xl mx-auto border border-[#E1E4E8]">
                <p class="text-lg text-[#313131] mb-4">To mark components as featured:</p>
                <ul class="text-[#505050] list-disc list-inside space-y-2">
                    <li>Go to the Django admin panel</li>
                    <li>Navigate to Tools & Components</li>
                    <li>Edit a component and check the "Is featured" checkbox</li>
                    <li>Set a "Showcase priority" (higher numbers appear first)</li>
                    <li>Save the component</li>
                </ul>
            </div>
        </div>
        {% else %}

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Item Type Sidebar (Left) -->
            <div class="lg:w-1/4">
                <!-- Mobile: Horizontal scroll -->
                <div class="lg:hidden mb-6 sticky top-16 z-30 bg-[#F5F6F8] py-4 -mx-4 px-4">
                    <h3 class="text-lg font-semibold text-[#313131] mb-4">Item Types</h3>
                    <div class="overflow-x-auto">
                        <nav class="flex space-x-3 pb-2" id="itemtype-nav-mobile">
                            {% for itemtype in itemtype_metadata %}
                            <a href="#{{ itemtype.slug }}" 
                               class="itemtype-nav-item flex-shrink-0 flex items-center justify-between px-4 py-3 rounded-2xl border border-[#E1E4E8] hover:border-[#0089D9] hover:bg-[#F5F6F8] transition-all duration-200 group whitespace-nowrap"
                               data-itemtype="{{ itemtype.slug }}">
                                <span class="font-medium text-[#505050] group-hover:text-[#006FB3]">{{ itemtype.name }}</span>
                                <span class="bg-[#F5F6F8] text-[#505050] text-sm px-2 py-1 rounded-full group-hover:bg-[#0089D9] group-hover:text-[#006FB3] ml-2">
                                    {{ itemtype.count }}
                                </span>
                            </a>
                            {% endfor %}
                        </nav>
                    </div>
                </div>
                
                <!-- Desktop: Vertical sidebar -->
                <div class="hidden lg:block sticky top-20 self-start z-40">
                    <div class="bg-white rounded-2xl shadow-lg border border-[#E1E4E8] p-6">
                            <h3 class="text-lg font-semibold text-[#313131] mb-4">Item Types</h3>
                            <nav class="space-y-2" id="itemtype-nav">
                                {% for itemtype in itemtype_metadata %}
                                <a href="#{{ itemtype.slug }}" 
                                   class="itemtype-nav-item flex items-center justify-between p-3 rounded-2xl border border-[#E1E4E8] hover:border-[#0089D9] hover:bg-[#F5F6F8] transition-all duration-200 group"
                                   data-itemtype="{{ itemtype.slug }}">
                                    <span class="font-medium text-[#505050] group-hover:text-[#006FB3]">{{ itemtype.name }}</span>
                                    <span class="bg-[#F5F6F8] text-[#505050] text-sm px-2 py-1 rounded-full group-hover:bg-[#0089D9] group-hover:text-[#006FB3]">
                                        {{ itemtype.count }}
                                    </span>
                                </a>
                                {% endfor %}
                            </nav>
                    </div>
                </div>
            </div>

            <!-- Main Content (Right) -->
            <div class="lg:w-3/4">
                    {% for itemtype_name, itemtype_data in organized_products.items %}
                <section id="{{ itemtype_data.itemtype_slug }}" class="mb-16 scroll-mt-20">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-[#313131] mb-2">{{ itemtype_name }}</h2>
                        <div class="w-16 h-1 bg-[#0089D9] rounded"></div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        {% for component in itemtype_data.components %}
                        <div class="bg-white rounded-2xl shadow-sm border border-[#E1E4E8] hover:shadow-md transition-shadow duration-300 overflow-hidden group">
                            <!-- Product Image -->
                            <div class="aspect-square bg-[#F5F6F8] p-6 flex items-center justify-center">
                                {% if component.image %}
                                    <img src="{{ component.image }}" 
                                         alt="{{ component.name }}" 
                                         class="max-w-full max-h-full object-contain group-hover:scale-105 transition-transform duration-300">
                                        {% else %}
                                            <div class="w-full h-full flex items-center justify-center text-[#505050]">
                                                <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                                                </svg>
                                            </div>
                                        {% endif %}
                                    </div>
                            
                            <!-- Product Details -->
                            <div class="p-6">
                                <!-- Brand Badge -->
                                <div class="flex items-center justify-between mb-3">
                                    {% if component.brand %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#0089D9] text-white">
                                        {{ component.brand.name }}
                                            </span>
                                    {% endif %}
                                    {% if component.sku %}
                                    <span class="text-xs text-[#505050]">Model: {{ component.sku }}</span>
                                            {% endif %}
                                        </div>
                                
                                <!-- Product Name -->
                                <h3 class="text-lg font-semibold text-[#313131] mb-3 line-clamp-2">
                                    {{ component.name }}
                                </h3>
                                
                                <!-- Key Specifications -->
                                <div class="space-y-2 mb-4">
                                    {% if component.batteryvoltages.exists %}
                                    <div class="flex items-center text-sm text-[#505050]">
                                        <svg class="w-4 h-4 mr-2 text-[#505050]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        {% for voltage in component.batteryvoltages.all %}{{ voltage.value }}V{% if not forloop.last %}, {% endif %}{% endfor %}
                                    </div>
                                    {% endif %}
                                    
                                    {% if component.batteryplatforms.exists %}
                                    <div class="flex items-center text-sm text-[#505050]">
                                        <svg class="w-4 h-4 mr-2 text-[#505050]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                        {% for platform in component.batteryplatforms.all %}{{ platform.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
                                    </div>
                                    {% endif %}
                                    
                                    <!-- Key Attributes -->
                                    {% for attr in component.componentattributes_set.all|slice:":2" %}
                                    <div class="flex items-center text-sm text-[#505050]">
                                        <svg class="w-4 h-4 mr-2 text-[#505050]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        {{ attr.attribute.name }}: {{ attr|format_attribute_value }}{% if attr.attribute.unit %} {{ attr.attribute.unit }}{% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <!-- Description -->
                                {% if component.description %}
                                <p class="text-sm text-[#505050] mb-4 line-clamp-2">
                                    {{ component.description|truncatewords:20 }}
                                </p>
                                {% endif %}
                                
                                <!-- View Details Button -->
                                <a href="/components/{{ component.id }}/" 
                                   class="inline-flex items-center justify-center w-full px-4 py-2 bg-[#0089D9] text-white text-sm font-medium rounded-2xl hover:bg-[#006FB3] transition-colors duration-200 group">
                                    View Details
                                    <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                    {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.itemtype-nav-item.active {
    border-color: #0089D9;
    background-color: #F5F6F8;
}

.itemtype-nav-item.active span:first-child {
    color: #0089D9;
}

.itemtype-nav-item.active span:last-child {
    background-color: #0089D9;
    color: white;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Smooth scroll to sections
    const navItems = document.querySelectorAll('.itemtype-nav-item');
    const sections = document.querySelectorAll('section[id]');
    
    // Handle navigation clicks
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);
            
            if (targetSection) {
                targetSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Update URL hash
                history.pushState(null, null, '#' + targetId);
            }
        });
    });
    
    // Intersection Observer for active state
    const observerOptions = {
        rootMargin: '-20% 0px -70% 0px',
        threshold: 0
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Remove active class from all nav items
                navItems.forEach(item => item.classList.remove('active'));
                
                // Add active class to corresponding nav items (both mobile and desktop)
                const activeItems = document.querySelectorAll(`[href="#${entry.target.id}"]`);
                activeItems.forEach(item => item.classList.add('active'));
            }
        });
    }, observerOptions);
    
    // Observe all sections
    sections.forEach(section => {
        observer.observe(section);
    });
    
    // Set initial active state based on URL hash
    const hash = window.location.hash;
    if (hash) {
        const activeItems = document.querySelectorAll(`[href="${hash}"]`);
        activeItems.forEach(item => item.classList.add('active'));
    } else if (navItems.length > 0) {
        // Set first item as active if no hash
        const firstItems = document.querySelectorAll('.itemtype-nav-item');
        firstItems.forEach(item => item.classList.add('active'));
    }
    
    // Mobile horizontal scroll behavior
    const mobileNav = document.getElementById('itemtype-nav-mobile');
    if (mobileNav) {
        // Auto-scroll to active item on mobile
        const activeItem = mobileNav.querySelector('.itemtype-nav-item.active');
        if (activeItem) {
            activeItem.scrollIntoView({
                behavior: 'smooth',
                block: 'nearest',
                inline: 'center'
            });
        }
    }
});
</script>
{% endblock %}